# Story 1: Определение стабильных CSS-селекторов Ozon

## Контекст
Ozon использует CSS Modules с динамически генерируемыми классами (`tsBody500Medium`, `x5y_23`), которые меняются при каждой сборке. Это делает невозможным использование таких классов для надежной автоматизации.

## Цель
Составить карту **стабильных селекторов** для всех ключевых элементов интерфейса Ozon.

## Задачи

### 1. Исследование страницы поиска
Найти и зафиксировать значения атрибутов для:
- [ ] Поисковая строка (input)
- [ ] Кнопка поиска
- [ ] Контейнер результатов поиска (`data-widget="searchResultsV2"` или аналог)
- [ ] Карточка товара в выдаче
- [ ] Пагинация / бесконечный скролл

### 2. Исследование карточки товара (PDP)
Найти и зафиксировать:
- [ ] Кнопка "В корзину" (`data-widget="webAddToCart"` или аналог)
- [ ] Кнопка уменьшения количества / удаления ("минус"), появляющаяся после добавления
- [ ] Кнопка увеличения количества ("плюс"), появляющаяся после добавления
- [ ] Счетчик количества товара в корзине на PDP
- [ ] Селектор вариаций (размер/цвет/объём)
- [ ] Блок цены
- [ ] Блок характеристик
- [ ] Блок описания

### 3. Исследование корзины и хедера
- [ ] Иконка корзины со счётчиком
- [ ] Модальное окно мини-корзины (если есть)
- [ ] Ссылки навигации (Каталог, Избранное)

### 4. Исследование модальных окон
- [ ] Popup выбора города
- [ ] Popup "Вам есть 18 лет?"
- [ ] Рекламные баннеры/оверлеи

## Приоритет селекторов (от надёжного к менее надёжному)
1. `data-widget="..."` — самый стабильный
2. `data-test-id="..."` / `test-id="..."` — для внутреннего тестирования
3. `aria-label="..."` — человекочитаемые метки
4. Иерархический путь (виджет → дочерний элемент)

## Формат результата
Создать файл `selectors/ozon-selectors.json`:

```json
{
  "search": {
    "input": "[data-widget='searchInput'] input",
    "button": "[data-widget='searchInput'] button",
    "results": "[data-widget='searchResultsV2']"
  },
  "product": {
    "addToCart": "[data-widget='webAddToCart'] button",
    "decrement": "[data-widget='webAddToCart'] [data-test-id='minus-button']",
    "increment": "[data-widget='webAddToCart'] [data-test-id='plus-button']",
    "quantity": "[data-widget='webAddToCart'] [data-test-id='quantity-value']",
    "price": "[data-widget='webPrice']",
    "variations": "[data-widget='webSingleVariant']"
  },
  "cart": {
    "icon": "[data-widget='headerCart']",
    "counter": "[data-widget='headerCart'] span.count"
  },
  "modals": {
    "city": "[data-widget='citySelector']",
    "age": "[data-widget='ageConfirmation']"
  }
}
```

## Acceptance Criteria
- [ ] Карта селекторов покрывает операции добавления и удаления товара (кнопки +/-, счетчик)
- [ ] Карта селекторов покрывает минимум 15 ключевых элементов
- [ ] Каждый селектор проверен и работает
- [ ] Селекторы не зависят от динамических классов
- [ ] Документация к каждому селектору с описанием

## Технический подход
Использовать `browser_evaluate` для исследования DOM:
```javascript
// Найти все data-widget атрибуты на странице
[...document.querySelectorAll('[data-widget]')].map(el => ({
  widget: el.dataset.widget,
  tag: el.tagName,
  text: el.textContent.slice(0, 50)
}))
```

## Зависимости
- Расширение Chrome подключено к MCP серверу
- Открыта страница ozon.ru

## Оценка: 3 story points
